<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Your QR Code | Premium Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Premium Color System */
            --primary: #EC4899;
            --primary-soft: #FCE7F3;
            --secondary: #8B5CF6;
            --accent: #F472B6;
            --text-main: #2B2B2B;
            --text-soft: #6B7280;
            --border-soft: #E5E7EB;
            --bg-page: #FDF7FB;
            --card-bg: #FFFFFF;
            --input-bg: #F9FAFB;
            --shadow-primary: rgba(236, 72, 153, 0.15);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-page);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: var(--text-main);
            margin: 0;
            position: relative;
            overflow-x: hidden;
        }

        /* Ambient Layers in Background */
        .ambient-blob {
            position: fixed;
            border-radius: 50%;
            filter: blur(100px);
            z-index: -1;
            opacity: 0.5;
            animation: float 20s infinite alternate;
        }
        @keyframes float {
            0% { transform: translate(0, 0); }
            100% { transform: translate(100px, 50px); }
        }

        /* Main Card with Premium Depth */
        .main-card {
            background: var(--card-bg);
            border-radius: 32px;
            box-shadow: 
                0 25px 50px -12px var(--shadow-primary),
                0 4px 12px rgba(0,0,0,0.05);
            width: 100%;
            max-width: 1000px;
            padding: 48px;
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
        }

        .title-gradient {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        /* QR Preview Section - Fixed container size to prevent overflow */
        .preview-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            border-radius: 24px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 440px;
            max-height: 440px;
            position: relative;
            border: 2px solid transparent;
            background-clip: padding-box;
            box-shadow: inset 0 0 0 2px var(--bg-page);
            overflow: hidden;
        }
        .preview-card::after {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            z-index: -1;
            border-radius: 24px;
            opacity: 0.2;
        }

        #qrCanvas {
            max-width: 100%;
            max-height: 100%;
            height: auto !important;
            width: auto !important;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            object-fit: contain;
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.98); } to { opacity: 1; transform: scale(1); } }

        /* Form Controls */
        .input-group label {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-soft);
            margin-bottom: 8px;
            display: block;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .input-field {
            background: var(--input-bg);
            border: 2px solid var(--border-soft);
            border-radius: 16px;
            padding: 14px 20px;
            width: 100%;
            transition: all 0.25s ease;
            color: var(--text-main);
            outline: none;
        }
        .input-field:focus {
            border-color: var(--primary);
            background: white;
            box-shadow: 0 0 0 4px rgba(236, 72, 153, 0.1);
        }

        /* Action Button */
        .btn-download {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 18px;
            padding: 16px;
            font-weight: 700;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 12px 30px rgba(236, 72, 153, 0.35);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
            border: none;
        }
        .btn-download:hover {
            transform: translateY(-2px);
            filter: brightness(1.05);
            box-shadow: 0 16px 40px rgba(236, 72, 153, 0.45);
        }

        /* Size Tabs Visibility Fix */
        .size-group {
            background: #F3F4F6;
            padding: 4px;
            border-radius: 18px;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 4px;
        }
        .sz-btn {
            padding: 12px 4px;
            border-radius: 14px;
            font-size: 0.75rem;
            font-weight: 700;
            color: #4B5563;
            transition: all 0.2s ease;
            text-align: center;
            background: transparent;
        }
        .sz-btn:hover { color: var(--text-main); background: rgba(255, 255, 255, 0.5); }
        .sz-btn.active { background: white; color: var(--primary); box-shadow: 0 4px 10px rgba(0,0,0,0.06); }

        .color-badge {
            background: var(--input-bg);
            border: 1px solid var(--border-soft);
            padding: 4px 8px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Toggle Switch Custom */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background-color: #D1D5DB;
            transition: .3s;
            border-radius: 34px;
        }
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px; width: 18px;
            left: 3px; bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }
        input:checked + .toggle-slider { background: linear-gradient(135deg, var(--primary), var(--secondary)); }
        input:checked + .toggle-slider:before { transform: translateX(20px); }

        .clear-btn {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 48px;
            height: 48px;
            background: white;
            border: 1px solid var(--border-soft);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-soft);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .clear-btn:hover { transform: rotate(180deg); color: var(--primary); border-color: var(--primary-soft); }

        @media (max-width: 768px) {
            .main-card { padding: 32px 24px; border-radius: 0; }
            .preview-card { min-height: 320px; max-height: 320px; }
        }
    </style>
</head>
<body>

    <!-- Ambient Decor Layers -->
    <div class="ambient-blob w-[500px] h-[500px] bg-pink-100 top-[-150px] left-[-150px]"></div>
    <div class="ambient-blob w-[400px] h-[400px] bg-indigo-100 bottom-[-100px] right-[-100px]"></div>

    <!-- Notification Toast -->
    <div id="toast" class="fixed top-6 left-1/2 -translate-x-1/2 bg-white px-8 py-4 rounded-2xl shadow-2xl z-[2000] flex items-center gap-3 font-bold transition-all -translate-y-24 border border-pink-100">
        <span class="text-pink-500">âœ¨</span>
        <span id="toastText"></span>
    </div>

    <div class="main-card">
        <!-- Header - Simple and Clean -->
        <div class="mb-12 text-center md:text-left">
            <h1 class="text-4xl title-gradient">Create Your QR</h1>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-start">
            
            <!-- Left Side: Product Preview -->
            <div class="flex flex-col gap-8 order-2 md:order-1">
                <div>
                    <span class="section-title">
                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 24 24" class="inline mr-1"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
                        Product Preview
                    </span>
                    <div class="preview-card" id="qr-container">
                        <div id="loading" class="hidden absolute inset-0 bg-white/40 backdrop-blur-sm z-20 flex flex-col items-center justify-center">
                            <div class="w-8 h-8 border-4 border-pink-100 border-t-pink-500 rounded-full animate-spin"></div>
                        </div>
                        <canvas id="qrCanvas" style="display: none;"></canvas>
                        <div id="empty" class="text-center opacity-10">
                            <svg class="mx-auto mb-4" width="80" height="80" fill="currentColor" viewBox="0 0 24 24"><path d="M4 4h7v7H4V4zm2 2v3h3V6H6zm2 2H7V7h1V6H6v1h1v1h1V7h1v1H8zM4 13h7v7H4v-7zm2 2v3h3v-3H6zm1 1h1v1H7v-1zm7-12h7v7h-7V4zm2 2v3h3V6h-3zm1 4h1V9h-1v1zm3 3h3v2h-3v-2zm-3 3h3v2h-3v-2zm3-3h-3v2h3v-2zm-3 3h-3v2h3v-2zm3-3h3v2h-3v-2zm-3 3h3v2h-3v-2z"/></svg>
                            <p class="text-xs font-bold uppercase tracking-widest">Generating Preview...</p>
                        </div>
                    </div>
                </div>

                <button id="downloadBtn" class="btn-download">
                    <svg width="22" height="22" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>
                    Download
                </button>
            </div>

            <!-- Right Side: Configuration -->
            <div class="flex flex-col gap-10 order-1 md:order-2">
                
                <div class="input-group">
                    <label class="flex items-center gap-2 !text-pink-500">
                        <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24"><path d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>
                        QR Content
                    </label>
                    <input type="text" id="qrData" class="input-field font-semibold" placeholder="URL or Text..." value="https://www.google.com">
                </div>

                <div class="input-group">
                    <div class="flex justify-between items-center mb-2">
                        <label class="!mb-0">Caption Text</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="toggleCap" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <input type="text" id="capInput" class="input-field" placeholder="Tagline appearing on image...">
                </div>

                <div class="grid grid-cols-2 gap-6">
                    <div class="input-group">
                        <label>Foreground</label>
                        <div class="color-badge">
                            <input type="color" id="qrColor" value="#000000" class="w-8 h-8 cursor-pointer rounded-lg border-none bg-none">
                            <span id="fgHex" class="font-mono text-[10px] font-bold opacity-60">#000000</span>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Canvas</label>
                        <div class="color-badge">
                            <input type="color" id="bgColor" value="#ffffff" class="w-8 h-8 cursor-pointer rounded-lg border-none bg-none">
                            <span id="bgHex" class="font-mono text-[10px] font-bold opacity-60">#FFFFFF</span>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Image Dimensions</label>
                    <div class="size-group">
                        <button class="sz-btn" data-sz="128">Small<br>128px</button>
                        <button class="sz-btn active" data-sz="256">Medium<br>256px</button>
                        <button class="sz-btn" data-sz="512">Large<br>512px</button>
                    </div>
                </div>

                <div class="input-group">
                    <label>Brand Logo</label>
                    <div class="relative group">
                        <input type="file" id="logoInp" accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer z-10">
                        <div class="flex items-center gap-4 bg-gray-50 p-4 rounded-2xl border-2 border-dashed border-gray-200 transition-all group-hover:border-pink-400 group-hover:bg-pink-50/30">
                            <div class="w-12 h-12 bg-white rounded-full flex items-center justify-center shadow-sm overflow-hidden border-2 border-white" id="logoPreview">
                                <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
                            </div>
                            <div class="flex flex-col">
                                <span id="fileName" class="text-sm font-bold">Add Logo</span>
                                <span class="text-[9px] opacity-40 uppercase font-bold tracking-wider">Masked Circle</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Float Refresh -->
        <button id="clearBtn" class="clear-btn" title="Reset fields">
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
        </button>
    </div>

    <script src="https://cdn.rawgit.com/davidshimjs/qrcodejs/gh-pages/qrcode.min.js"></script>
    <script>
        const dom = {
            data: document.getElementById('qrData'),
            cap: document.getElementById('capInput'),
            qrCol: document.getElementById('qrColor'),
            bgCol: document.getElementById('bgColor'),
            logo: document.getElementById('logoInp'),
            canvas: document.getElementById('qrCanvas'),
            toast: document.getElementById('toast'),
            toastMsg: document.getElementById('toastText'),
            logoBox: document.getElementById('logoPreview'),
            showCap: document.getElementById('toggleCap'),
            load: document.getElementById('loading'),
            download: document.getElementById('downloadBtn'),
            fgHex: document.getElementById('fgHex'),
            bgHex: document.getElementById('bgHex'),
            reset: document.getElementById('clearBtn')
        };

        let logoImg = null;
        let currentSize = 256;
        let genDebounce = null;

        function showToast(msg) {
            dom.toastMsg.innerText = msg;
            dom.toast.classList.add('!-translate-y-0');
            setTimeout(() => dom.toast.classList.remove('!-translate-y-0'), 3000);
        }

        // Smart text wrapping for Canvas
        function getLines(ctx, text, maxWidth) {
            const chars = text.split('');
            let lines = [];
            let current = '';
            for (let char of chars) {
                let test = current + char;
                if (ctx.measureText(test).width > maxWidth && current.length > 0) {
                    lines.push(current);
                    current = char;
                } else {
                    current = test;
                }
            }
            lines.push(current);
            return lines;
        }

        function generate() {
            if (genDebounce) clearTimeout(genDebounce);
            
            // Reduced debounce time for snappy immediate feel (150ms)
            genDebounce = setTimeout(() => {
                const text = dom.data.value.trim();
                if (!text) return;

                dom.load.classList.remove('hidden');
                document.getElementById('empty').style.display = 'none';

                const fontSize = Math.max(14, currentSize / 14);
                const lineHeight = fontSize * 1.5;
                const pad = 32;
                
                const ctx = dom.canvas.getContext('2d');
                ctx.font = `700 ${fontSize}px Inter, sans-serif`;
                
                const useCap = dom.showCap.checked && dom.cap.value.trim();
                let wrapped = useCap ? getLines(ctx, dom.cap.value.trim(), currentSize) : [];
                let capH = wrapped.length > 0 ? (wrapped.length * lineHeight) + 20 : 0;

                const finalW = currentSize + (pad * 2);
                const finalH = currentSize + capH + (pad * 2);

                const div = document.createElement('div');
                new QRCode(div, {
                    text: text, width: currentSize, height: currentSize,
                    colorDark: dom.qrCol.value, colorLight: dom.bgCol.value,
                    correctLevel: QRCode.CorrectLevel.H
                });

                setTimeout(() => {
                    const qr = div.querySelector('canvas');
                    if (!qr) { dom.load.classList.add('hidden'); return; }

                    dom.canvas.width = finalW;
                    dom.canvas.height = finalH;
                    ctx.fillStyle = dom.bgCol.value;
                    ctx.fillRect(0, 0, finalW, finalH);

                    if (useCap) {
                        ctx.font = `700 ${fontSize}px Inter, sans-serif`;
                        ctx.textAlign = 'center'; ctx.textBaseline = 'top';
                        ctx.fillStyle = dom.qrCol.value;
                        wrapped.forEach((line, i) => ctx.fillText(line, finalW/2, pad + (i * lineHeight)));
                    }

                    ctx.drawImage(qr, pad, pad + capH);

                    if (logoImg) {
                        const lSz = currentSize * 0.22;
                        const lx = (finalW - lSz) / 2;
                        const ly = (currentSize - lSz) / 2 + pad + capH;
                        
                        ctx.beginPath();
                        ctx.arc(lx + lSz/2, ly + lSz/2, (lSz/2) + 6, 0, Math.PI * 2);
                        ctx.fillStyle = dom.bgCol.value; ctx.fill();
                        
                        ctx.save();
                        ctx.beginPath();
                        ctx.arc(lx + lSz/2, ly + lSz/2, lSz/2, 0, Math.PI * 2);
                        ctx.clip();
                        ctx.drawImage(logoImg, lx, ly, lSz, lSz);
                        ctx.restore();
                    }

                    dom.canvas.style.display = 'block';
                    dom.load.classList.add('hidden');
                    save();
                }, 100);
            }, 150);
        }

        function save() {
            localStorage.setItem('qr_v6_instant', JSON.stringify({
                d: dom.data.value, c: dom.cap.value, q: dom.qrCol.value,
                b: dom.bgCol.value, s: currentSize, t: dom.showCap.checked
            }));
        }

        dom.logo.onchange = (e) => {
            const f = e.target.files[0];
            if (f) {
                document.getElementById('fileName').innerText = f.name;
                const r = new FileReader();
                r.onload = (ev) => {
                    const i = new Image();
                    i.onload = () => {
                        logoImg = i;
                        dom.logoBox.innerHTML = `<img src="${ev.target.result}" class="w-full h-full object-cover">`;
                        generate();
                    };
                    i.src = ev.target.result;
                };
                r.readAsDataURL(f);
            }
        };

        dom.download.onclick = () => {
            if (dom.canvas.style.display === 'none') return;
            const a = document.createElement('a');
            a.download = `QR_Export_${Date.now()}.jpg`;
            a.href = dom.canvas.toDataURL('image/jpeg', 0.95);
            a.click();
            showToast("Success! JPG Downloaded.");
        };

        document.querySelectorAll('.sz-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('.sz-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentSize = parseInt(btn.dataset.sz);
                generate();
            };
        });

        dom.reset.onclick = () => { localStorage.removeItem('qr_v6_instant'); location.reload(); };
        
        dom.qrCol.oninput = (e) => { dom.fgHex.innerText = e.target.value.toUpperCase(); generate(); };
        dom.bgCol.oninput = (e) => { dom.bgHex.innerText = e.target.value.toUpperCase(); generate(); };
        
        // Immediate updates linked here
        [dom.data, dom.cap, dom.showCap].forEach(el => {
            el.addEventListener('input', generate);
        });

        window.onload = () => {
            const sv = localStorage.getItem('qr_v6_instant');
            if (sv) {
                const c = JSON.parse(sv);
                dom.data.value = c.d; dom.cap.value = c.c;
                dom.qrCol.value = c.q; dom.bgCol.value = c.b;
                currentSize = c.s; dom.showCap.checked = c.t;
                dom.fgHex.innerText = c.q.toUpperCase(); dom.bgHex.innerText = c.b.toUpperCase();
                document.querySelectorAll('.sz-btn').forEach(b => {
                    b.classList.remove('active');
                    if (parseInt(b.dataset.sz) === c.s) b.classList.add('active');
                });
            }
            generate();
        };
    </script>
</body>
</html>
